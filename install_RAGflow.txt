================================================================================
ğŸ“š GUIDE D'INSTALLATION DE RAGFLOW DANS JUPYTERLAB (runAI Pod)
================================================================================

ğŸ¯ PRÃ‰REQUIS
================================================================================

âœ… Pod runAI avec JupyterLab actif
âœ… Au moins 16 GB de RAM allouÃ©e au pod (32 GB recommandÃ©)
âœ… Au moins 50 GB d'espace disque disponible
âœ… AccÃ¨s root ou sudo dans le pod (si nÃ©cessaire)
âœ… Connexion Internet stable

ğŸ“ Pour vÃ©rifier les ressources dans JupyterLab:
   Ouvrir un Terminal dans JupyterLab (File â†’ New â†’ Terminal)

   # VÃ©rifier la RAM disponible
   free -h

   # VÃ©rifier l'espace disque
   df -h

   # VÃ©rifier Docker (si disponible)
   docker --version


ğŸ”§ Ã‰TAPE 1: OUVRIR UN TERMINAL DANS JUPYTERLAB
================================================================================

ğŸ“± Dans JupyterLab:
   1. Cliquer sur File â†’ New â†’ Terminal
   2. Ou cliquer sur l'icÃ´ne "Terminal" dans le Launcher

ğŸ’¡ Toutes les commandes ci-dessous doivent Ãªtre exÃ©cutÃ©es dans ce terminal


ğŸ”§ Ã‰TAPE 2: CLONER LE DÃ‰PÃ”T RAGFLOW
================================================================================

ğŸ“¥ Cloner le repository depuis GitHub:
   git clone https://github.com/infiniflow/ragflow.git

ğŸ“‚ Se dÃ©placer dans le dossier:
   cd ragflow

ğŸ“ VÃ©rifier le contenu:
   ls -la


ğŸš€ Ã‰TAPE 3: VÃ‰RIFIER DOCKER DANS LE POD
================================================================================

ğŸ³ VÃ©rifier que Docker est disponible dans le pod:
   docker --version

ğŸ” VÃ©rifier que le daemon Docker fonctionne:
   docker ps

âš ï¸ Si Docker n'est pas disponible:
   - VÃ©rifier avec l'admin runAI si Docker-in-Docker est activÃ© pour le pod
   - Alternative: Demander un pod avec privilÃ¨ges Docker

ğŸ“Š VÃ©rifier les ressources Docker disponibles:
   docker info | grep -E "CPUs|Total Memory"


ğŸ—ï¸ Ã‰TAPE 3: CONFIGURER LES RESSOURCES (IMPORTANT!)
================================================================================

âš ï¸ RAGFlow nÃ©cessite au moins 16 GB de RAM total

ğŸ“Š VÃ©rifier la mÃ©moire du pod:
   free -h

ğŸ“Š VÃ©rifier l'espace disque:
   df -h ~

âš ï¸ Si insuffisant:
   - Demander Ã  l'admin runAI d'augmenter les ressources du pod
   - Minimum recommandÃ©: 16 GB RAM, 8 CPU cores, 50 GB disk


ğŸ¬ Ã‰TAPE 4: LANCER RAGFLOW AVEC DOCKER COMPOSE
================================================================================

ğŸ“‚ Se placer dans le dossier docker:
   cd ~/ragflow/docker
   # ou si vous avez clonÃ© ailleurs:
   cd /path/to/ragflow/docker

ğŸ“ VÃ©rifier le fichier docker-compose disponible:
   ls -la docker-compose*.yml

ğŸ”§ OPTION A - Pour serveurs runAI standard (x86/amd64):
   docker compose -f docker-compose.yml up -d

ğŸ”§ OPTION B - Pour serveurs runAI avec GPU:
   # Activer le GPU pour DeepDoc
   echo "DEVICE=gpu" >> .env
   docker compose -f docker-compose.yml up -d

ğŸ”§ OPTION C - Si l'image prÃ©-construite ne fonctionne pas:
   # Construire localement (peut prendre 15-30 min)
   docker compose -f docker-compose.yml build
   docker compose -f docker-compose.yml up -d

ğŸ’¡ TIP JUPYTERLAB: Vous pouvez crÃ©er un notebook pour monitorer le dÃ©marrage
   # Dans une cellule de notebook Python:
   !docker compose -f docker-compose.yml up -d


â±ï¸ Ã‰TAPE 5: ATTENDRE LE DÃ‰MARRAGE COMPLET
================================================================================

ğŸ“Š VÃ©rifier l'Ã©tat des conteneurs (dans le Terminal):
   docker ps

âœ… Vous devriez voir 5 conteneurs en cours d'exÃ©cution:
   - ragflow-server (ou ragflow-cpu ou docker-ragflow-cpu-1)
   - elasticsearch (es01 ou docker-es01-1)
   - mysql (docker-mysql-1)
   - redis (docker-redis-1)
   - minio (docker-minio-1)

ğŸ“‹ Suivre les logs de RAGFlow:
   docker logs -f docker-ragflow-cpu-1

â³ Attendre le message indiquant que RAGFlow est prÃªt (environ 2-5 minutes)

ğŸ’¡ MONITORING AVEC JUPYTERLAB NOTEBOOK:
   CrÃ©er un nouveau notebook Python et exÃ©cuter:

   ```python
   import subprocess
   import time

   def check_containers():
       result = subprocess.run(['docker', 'ps', '--format',
                               'table {{.Names}}\t{{.Status}}'],
                              capture_output=True, text=True)
       print(result.stdout)

   # VÃ©rifier toutes les 10 secondes
   for i in range(30):
       print(f"\nğŸ” VÃ©rification {i+1}/30")
       check_containers()
       time.sleep(10)
   ```


ğŸ” Ã‰TAPE 6: VÃ‰RIFIER LA SANTÃ‰ DES SERVICES
================================================================================

ğŸ¥ VÃ©rifier l'Ã©tat de santÃ© de chaque conteneur:
   docker ps --format "table {{.Names}}\t{{.Status}}"

âœ… Tous les conteneurs doivent afficher "healthy" ou "Up"

ğŸ“Š VÃ©rifier les logs en cas de problÃ¨me:
   docker logs docker-ragflow-server-1
   docker logs docker-es01-1
   docker logs docker-mysql-1
   docker logs docker-redis-1
   docker logs docker-minio-1


ğŸŒ Ã‰TAPE 7: ACCÃ‰DER Ã€ RAGFLOW DEPUIS JUPYTERLAB
================================================================================

ğŸ–¥ï¸ OPTION A - AccÃ¨s via Port Forwarding runAI:

   1ï¸âƒ£ Dans le terminal du pod:
      # VÃ©rifier que RAGFlow Ã©coute sur le port 80
      netstat -tuln | grep :80

   2ï¸âƒ£ Depuis votre machine locale:
      # Utiliser kubectl pour faire du port forwarding
      kubectl port-forward <pod-name> 8080:80 -n <namespace>

   3ï¸âƒ£ Ouvrir dans votre navigateur:
      http://localhost:8080

ğŸ–¥ï¸ OPTION B - AccÃ¨s direct dans le pod (si disponible):

   URL interne: http://localhost:80
   ou: http://127.0.0.1:80

   ğŸ’¡ Vous pouvez crÃ©er un lien dans JupyterLab:
      1. CrÃ©er un fichier HTML dans JupyterLab
      2. Ajouter: <a href="http://localhost:80">Ouvrir RAGFlow</a>

ğŸ–¥ï¸ OPTION C - Via Jupyter Proxy (si configurÃ©):

   /proxy/80/

ğŸ“¡ API RAGFlow:
   Ports: 9380-9382
   AccÃ¨s: http://localhost:9380

ğŸ”‘ PremiÃ¨re connexion:
   - Suivre les instructions Ã  l'Ã©cran pour crÃ©er un compte admin
   - Username par dÃ©faut: admin
   - CrÃ©er un mot de passe sÃ©curisÃ©

ğŸ’¡ ASTUCE JUPYTERLAB - Tester l'accÃ¨s avec Python:
   ```python
   import requests
   try:
       response = requests.get('http://localhost:80', timeout=5)
       print(f"âœ… RAGFlow accessible! Status: {response.status_code}")
   except Exception as e:
       print(f"âŒ Erreur: {e}")
   ```


ğŸ› ï¸ COMMANDES UTILES POUR LA GESTION
================================================================================

ğŸ”„ RedÃ©marrer tous les conteneurs:
   docker compose restart

â¸ï¸ ArrÃªter tous les conteneurs:
   docker compose stop

ğŸ—‘ï¸ ArrÃªter et supprimer tous les conteneurs:
   docker compose down

âš ï¸ ArrÃªter et supprimer conteneurs + volumes (PERTE DE DONNÃ‰ES):
   docker compose down -v

ğŸ“Š Voir les logs en temps rÃ©el:
   docker compose logs -f

ğŸ’¾ Voir l'utilisation des volumes:
   docker volume ls


ğŸ““ Ã‰TAPE 8: UTILISER RAGFLOW DANS JUPYTERLAB (NOTEBOOKS)
================================================================================

ğŸ CrÃ©er un notebook Python pour interagir avec RAGFlow:

   ```python
   # Cellule 1: Installation du SDK RAGFlow
   !pip install ragflow-sdk

   # Cellule 2: Configuration
   from ragflow import RAGFlow

   # Remplacer par votre URL et API key
   rag = RAGFlow(api_key="your_api_key", base_url="http://localhost:80")

   # Cellule 3: Test de connexion
   print("âœ… ConnectÃ© Ã  RAGFlow!")

   # Cellule 4: Upload d'un document
   dataset = rag.create_dataset(name="mon_dataset")
   dataset.upload_file("chemin/vers/fichier.pdf")

   # Cellule 5: RequÃªte
   response = rag.query("Votre question ici")
   print(response)
   ```

ğŸ“Š CrÃ©er un notebook de monitoring:

   ```python
   # Monitoring des conteneurs Docker
   import subprocess
   import pandas as pd
   from IPython.display import display, clear_output
   import time

   def get_docker_stats():
       result = subprocess.run(
           ['docker', 'stats', '--no-stream', '--format',
            'table {{.Name}}\t{{.CPUPerc}}\t{{.MemUsage}}'],
           capture_output=True, text=True
       )
       return result.stdout

   # RafraÃ®chir toutes les 5 secondes
   while True:
       clear_output(wait=True)
       print("ğŸ“Š Ã‰tat des conteneurs RAGFlow\n")
       print(get_docker_stats())
       time.sleep(5)
   ```


ğŸ› DÃ‰PANNAGE - PROBLÃˆMES COURANTS DANS RUNAI POD
================================================================================

âŒ PROBLÃˆME: "Elasticsearch is unhealthy"
   âœ… SOLUTION:
      - VÃ©rifier la RAM du pod: free -h
      - Demander plus de RAM Ã  l'admin (minimum 16 GB)
      - RedÃ©marrer: cd ~/ragflow/docker && docker compose restart

âŒ PROBLÃˆME: "Cannot connect to Docker daemon"
   âœ… SOLUTION:
      - VÃ©rifier si Docker est activÃ© dans le pod
      - Contacter l'admin runAI pour activer Docker-in-Docker
      - Alternative: Demander un pod avec --privileged flag

âŒ PROBLÃˆME: Conteneur plante avec "exit code 137"
   âœ… SOLUTION:
      - Manque de mÃ©moire dans le pod
      - Demander Ã  l'admin d'augmenter les ressources
      - Ou arrÃªter d'autres services dans le pod

âŒ PROBLÃˆME: "Port 80 already in use"
   âœ… SOLUTION:
      - VÃ©rifier les processus: netstat -tuln | grep :80
      - ArrÃªter le service: kill <pid>
      - Ou modifier le port dans docker-compose.yml:
        ports:
          - "8080:80"  # Utiliser le port 8080 Ã  la place

âŒ PROBLÃˆME: "No space left on device"
   âœ… SOLUTION:
      - VÃ©rifier l'espace: df -h
      - Nettoyer les images Docker: docker system prune -a
      - Demander plus d'espace disque au pod

âŒ PROBLÃˆME: Impossible d'accÃ©der Ã  RAGFlow depuis l'extÃ©rieur
   âœ… SOLUTION:
      - Utiliser kubectl port-forward depuis votre machine
      - Ou demander un Ingress/Service Ã  l'admin runAI
      - VÃ©rifier les Network Policies du cluster


ğŸ“¦ INFORMATIONS SUR LES SERVICES
================================================================================

ğŸ”§ Services dÃ©ployÃ©s par RAGFlow:

1ï¸âƒ£ RAGFlow Server (Port 80, 443, 9380-9382)
   - Application principale
   - Interface web et API

2ï¸âƒ£ Elasticsearch (Port 1200)
   - Base de donnÃ©es de recherche vectorielle
   - NÃ©cessite 2-4 GB RAM minimum

3ï¸âƒ£ MySQL (Port 5455)
   - Base de donnÃ©es relationnelle
   - Stockage des mÃ©tadonnÃ©es

4ï¸âƒ£ Redis (Port 6379)
   - Cache en mÃ©moire
   - Gestion des sessions

5ï¸âƒ£ MinIO (Port 9000-9001)
   - Stockage d'objets (S3-compatible)
   - Stockage des fichiers uploadÃ©s


ğŸ’¾ PERSISTANCE DES DONNÃ‰ES DANS RUNAI POD
================================================================================

âš ï¸ IMPORTANT: Les donnÃ©es dans un pod sont Ã©phÃ©mÃ¨res par dÃ©faut!

ğŸ—‚ï¸ Utiliser un PVC (Persistent Volume Claim) pour sauvegarder les donnÃ©es:

   1ï¸âƒ£ VÃ©rifier les PVC montÃ©s:
      df -h | grep /mnt

   2ï¸âƒ£ DÃ©placer les volumes Docker vers un PVC:
      # Si vous avez un PVC montÃ© sur /mnt/data
      cd ~/ragflow/docker
      # Modifier docker-compose.yml pour pointer vers /mnt/data

   3ï¸âƒ£ Alternative - CrÃ©er des volumes nommÃ©s:
      docker volume create --driver local \
        --opt type=none \
        --opt o=bind \
        --opt device=/mnt/data/ragflow \
        ragflow_data


ğŸ“‹ COMMANDES KUBECTL UTILES DEPUIS VOTRE MACHINE LOCALE
================================================================================

ğŸ” Lister vos pods runAI:
   kubectl get pods -n <votre-namespace>

ğŸ”Œ Port forwarding pour accÃ©der Ã  RAGFlow:
   kubectl port-forward <pod-name> 8080:80 -n <namespace>

ğŸ“Š Voir les logs du pod:
   kubectl logs <pod-name> -n <namespace> --tail=100 -f

ğŸ’» ExÃ©cuter une commande dans le pod:
   kubectl exec -it <pod-name> -n <namespace> -- bash

ğŸ“¦ Copier des fichiers vers/depuis le pod:
   # Vers le pod
   kubectl cp fichier.txt <pod-name>:/home/jovyan/ -n <namespace>

   # Depuis le pod
   kubectl cp <pod-name>:/home/jovyan/fichier.txt ./fichier.txt -n <namespace>


ğŸ” SÃ‰CURITÃ‰ - POUR ENVIRONNEMENT DE PRODUCTION RUNAI
================================================================================

âš ï¸ Pour un dÃ©ploiement en production sur runAI:

1ï¸âƒ£ Modifier les mots de passe par dÃ©faut:
   cd ~/ragflow/docker
   # Ã‰diter le fichier .env
   nano .env
   # Changer: MYSQL_PASSWORD, REDIS_PASSWORD, etc.

2ï¸âƒ£ Utiliser des Secrets Kubernetes:
   # Stocker les credentials dans des secrets K8s
   kubectl create secret generic ragflow-secrets \
     --from-literal=mysql-password=<password> \
     -n <namespace>

3ï¸âƒ£ Configurer HTTPS (via Ingress runAI):
   # Demander un Ingress Ã  l'admin avec certificat TLS

4ï¸âƒ£ Limiter l'accÃ¨s rÃ©seau:
   # Configurer des Network Policies
   # Autoriser uniquement les pods nÃ©cessaires

5ï¸âƒ£ Backups rÃ©guliers:
   # CrÃ©er un CronJob pour sauvegarder les volumes
   # Ou utiliser Velero pour backup du cluster

6ï¸âƒ£ Monitoring avec Prometheus/Grafana:
   # Si disponible dans votre cluster runAI
   # CrÃ©er des dashboards pour monitorer RAGFlow


ğŸš€ SCRIPT DE DÃ‰MARRAGE AUTOMATIQUE POUR JUPYTERLAB
================================================================================

ğŸ’¡ CrÃ©er un script pour dÃ©marrer RAGFlow automatiquement:

   1ï¸âƒ£ CrÃ©er le fichier ~/start_ragflow.sh:
      cat > ~/start_ragflow.sh << 'EOF'
      #!/bin/bash
      echo "ğŸš€ DÃ©marrage de RAGFlow..."
      cd ~/ragflow/docker
      docker compose up -d
      echo "âœ… RAGFlow dÃ©marrÃ©!"
      echo "ğŸŒ AccÃ¨s: http://localhost:80"
      EOF

   2ï¸âƒ£ Rendre le script exÃ©cutable:
      chmod +x ~/start_ragflow.sh

   3ï¸âƒ£ Ajouter au ~/.bashrc pour dÃ©marrage automatique:
      echo "~/start_ragflow.sh" >> ~/.bashrc

   4ï¸âƒ£ Ou crÃ©er un bouton dans JupyterLab:
      # CrÃ©er un fichier start_ragflow.ipynb avec:
      !~/start_ragflow.sh


ğŸ“š RESSOURCES SUPPLÃ‰MENTAIRES
================================================================================

ğŸ“– Documentation officielle RAGFlow:
   https://github.com/infiniflow/ragflow

ğŸ“– Documentation runAI:
   https://docs.run.ai/

ğŸ› Rapporter des bugs RAGFlow:
   https://github.com/infiniflow/ragflow/issues

ğŸ’¬ Support communautaire:
   - GitHub Discussions
   - Discord RAGFlow

ğŸ“ Tutoriels JupyterLab + RAGFlow:
   - CrÃ©er vos propres notebooks d'interaction
   - Automatiser les workflows RAG
   - IntÃ©gration avec vos modÃ¨les ML


ğŸ“ CHECKLIST FINALE AVANT DE QUITTER LE POD
================================================================================

âœ… VÃ©rifier que tous les conteneurs sont "healthy":
   docker ps

âœ… Sauvegarder vos donnÃ©es importantes vers un PVC:
   cp -r ~/ragflow/docker /mnt/data/backup/

âœ… Documenter vos configurations personnalisÃ©es:
   # Sauvegarder les .env et configs modifiÃ©s

âœ… CrÃ©er un snapshot du pod (si possible):
   # Via l'interface runAI ou kubectl

âœ… Tester l'accÃ¨s Ã  RAGFlow:
   curl http://localhost:80

âœ… ArrÃªter proprement avant de fermer le pod:
   cd ~/ragflow/docker
   docker compose down  # Si vous ne voulez pas persister
   # OU
   # Laisser tourner si le pod reste actif


ğŸ¯ RACCOURCIS JUPYTERLAB UTILES
================================================================================

ğŸ”§ CrÃ©er des favoris dans JupyterLab:

   1. Terminal â†’ cd ~/ragflow/docker
   2. Clic droit sur le dossier â†’ Add to Favorites

ğŸ”§ CrÃ©er des cellules magiques utiles:

   ```python
   # Dans un notebook, crÃ©er des raccourcis
   %alias ragflow_status docker ps --format 'table {{.Names}}\t{{.Status}}'
   %alias ragflow_logs docker logs -f docker-ragflow-cpu-1
   %alias ragflow_restart cd ~/ragflow/docker && docker compose restart
   ```


================================================================================
âœ¨ FIN DU GUIDE - BONNE INSTALLATION SUR RUNAI! âœ¨
================================================================================

ğŸ“… DerniÃ¨re mise Ã  jour: Janvier 2026
ğŸ·ï¸ Version RAGFlow: 0.23.1+
ğŸ–¥ï¸ Environnement: JupyterLab sur runAI Pod
ğŸ³ Docker-in-Docker requis
